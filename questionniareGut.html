<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Health Assessment - Svasth by Soumya</title>

    <!-- Include same CSS as services.html -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link rel="stylesheet" type="text/css" href="css/style.css" />

    <!-- Add professional Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Add this in the <head> section, inside a <style> tag -->
    <style>
      /* Professional Typography Enhancement */
      body {
        padding: 20px;
        background-color: #f9fafb;
        font-family: "Poppins", sans-serif;
        font-weight: 400;
        color: #333;
        line-height: 1.7;
        background-image: linear-gradient(
            rgba(249, 250, 251, 0.97),
            rgba(249, 250, 251, 0.97)
          ),
          url('data:image/svg+xml,%3Csvg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="%23c59a6d" fill-opacity="0.05" fill-rule="evenodd"%3E%3Ccircle cx="3" cy="3" r="3"/%3E%3Ccircle cx="13" cy="13" r="3"/%3E%3C/g%3E%3C/svg%3E');
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-family: "Playfair Display", serif;
        font-weight: 600;
        letter-spacing: -0.02em;
      }

      .section-title {
        text-align: center;
        margin-bottom: 40px;
      }

      .section-title h2 {
        font-family: "Playfair Display", serif;
        font-weight: 700;
        font-size: 2.5rem;
        color: #333;
        margin-bottom: 10px;
        position: relative;
        display: inline-block;
        padding-bottom: 15px;
      }

      .section-title h2:after {
        content: "";
        position: absolute;
        width: 80px;
        height: 3px;
        background: linear-gradient(to right, #c59a6d, transparent);
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
      }

      .section-title hr {
        display: none;
      }

      .section-title + p {
        font-family: "Poppins", sans-serif;
        font-weight: 300;
        font-size: 1.1rem;
        color: #666;
        max-width: 700px;
        margin: 0 auto 40px;
        text-align: center;
      }

      /* Keep existing styles but update colors and animations */
      .results-container {
        padding: 2rem;
        text-align: center;
      }

      .score-display {
        background: linear-gradient(135deg, #c59a6d, #e6c9a8);
        color: white;
        border-radius: 50%;
        width: 200px;
        height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 0 auto;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        animation: fadeInScale 0.5s ease-out;
      }

      .category-text {
        font-size: 1.2rem;
        margin-bottom: 10px;
        font-weight: 500;
      }

      #total-score {
        font-size: 3.5rem;
        font-weight: bold;
      }

      .score-interpretation {
        margin-top: 2rem;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        text-align: left;
      }

      .score-interpretation h3 {
        color: #c59a6d;
        margin-bottom: 1.5rem;
        text-align: center;
      }

      .score-interpretation p {
        line-height: 1.6;
        margin-bottom: 1.5rem;
      }

      .symptom-list {
        margin: 1rem 0;
        padding-left: 1.2rem;
        color: #e74c3c;
      }

      /* Rating Scale Styling */
      .question-container {
        padding: 20px;
        margin-bottom: 30px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        animation: fadeIn 0.8s ease-out both;
      }

      .question-container h4 {
        margin-bottom: 25px;
        color: #333;
        font-family: "Playfair Display", serif;
      }

      .rating-scale {
        display: flex;
        justify-content: space-between;
        margin: 20px 0;
        padding: 0 10px;
      }

      .rating-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        transition: transform 0.2s;
        width: 60px;
      }

      .rating-option:hover {
        transform: translateY(-3px);
      }

      .rating-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        margin-bottom: 8px;
        transition: all 0.3s ease;
      }

      .rating-label {
        font-size: 12px;
        text-align: center;
        color: #666;
      }

      /* Color scheme for rating circles - updated to match site theme */
      .rating-1 {
        background-color: #c59a6d;
      }
      .rating-2 {
        background-color: #d1aa7f;
      }
      .rating-3 {
        background-color: #deba91;
      }
      .rating-4 {
        background-color: #eacaa3;
      }
      .rating-5 {
        background-color: #f6dab5;
      }

      .rating-circle.selected {
        transform: scale(1.2);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      }

      /* Progress Bar Styling */
      .progress-container {
        margin: 20px 0 40px;
        position: relative;
      }

      .progress {
        height: 10px;
        background-color: #f0f0f0;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .progress-bar {
        background: linear-gradient(45deg, #c59a6d, #e6c9a8);
        height: 100%;
        border-radius: 20px;
        transition: width 0.5s ease;
        position: relative;
        overflow: hidden;
      }

      .progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.1) 25%,
          rgba(255, 255, 255, 0.2) 50%,
          rgba(255, 255, 255, 0.1) 75%
        );
        animation: shimmer 2s infinite;
      }

      .progress-status {
        text-align: center;
        margin-top: 8px;
        font-size: 14px;
        color: #666;
      }

      /* Question Navigation */
      .question-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        gap: 15px;
      }

      .calculate-btn {
        padding: 8px 24px;
        font-size: 14px;
        border-radius: 25px;
        border: none;
        background: linear-gradient(45deg, #c59a6d, #e6c9a8);
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 500;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .calculate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      .calculate-btn.disabled {
        opacity: 0.6;
        cursor: not-allowed;
        background: #ccc;
        transform: none;
        box-shadow: none;
      }

      .calculate-btn.previous-btn {
        background: #6c757d;
      }

      /* Enhanced animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      /* Keep all other existing styles */
      .results-container {
        padding: 2rem;
        text-align: center;
      }

      .score-display {
        background: linear-gradient(135deg, #c59a6d, #e6c9a8);
        color: white;
        border-radius: 50%;
        width: 200px;
        height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 0 auto;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        animation: fadeInScale 0.5s ease-out;
      }

      .category-text {
        font-size: 1.2rem;
        margin-bottom: 10px;
        font-weight: 500;
      }

      #total-score {
        font-size: 3.5rem;
        font-weight: bold;
      }

      .score-interpretation {
        margin-top: 2rem;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        text-align: left;
      }

      .score-interpretation h3 {
        color: #c59a6d;
        margin-bottom: 1.5rem;
        text-align: center;
      }

      .score-interpretation p {
        line-height: 1.6;
        margin-bottom: 1.5rem;
      }

      .symptom-list {
        margin: 1rem 0;
        padding-left: 1.2rem;
        color: #e74c3c;
      }

      .score-display {
        background: linear-gradient(135deg, #c59a6d, #e6c9a8);
        color: white;
        border-radius: 50%;
        width: 200px;
        height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        margin: 0 auto;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        animation: fadeInScale 0.5s ease-out;
      }

      .category-text {
        font-size: 1.2rem;
        margin-bottom: 10px;
        font-weight: 500;
      }

      #total-score {
        font-size: 3.5rem;
        font-weight: bold;
      }

      .score-interpretation {
        margin-top: 2rem;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        text-align: left;
      }

      .score-interpretation h3 {
        color: #c59a6d;
        margin-bottom: 1.5rem;
        text-align: center;
      }

      .score-interpretation p {
        line-height: 1.6;
        margin-bottom: 1.5rem;
      }

      .symptom-list {
        margin: 1rem 0;
        padding-left: 1.2rem;
        color: #e74c3c;
      }

      /* Mobile Responsiveness Fixes */
      @media (max-width: 768px) {
        /* Container adjustments */
        .container {
          padding: 10px;
          width: 100%;
        }

        /* Question container */
        .question-container {
          padding: 10px;
          margin-bottom: 20px;
        }

        .question-container h4 {
          font-size: 16px;
          line-height: 1.4;
        }

        /* Rating scale adjustments */
        .rating-scale {
          flex-wrap: wrap;
          gap: 10px;
          justify-content: center;
        }

        .rating-option {
          width: 50px;
          min-width: unset;
          margin: 5px;
        }

        .rating-circle {
          width: 35px;
          height: 35px;
          font-size: 14px;
        }

        .rating-label {
          font-size: 10px;
        }

        /* Custom scale adjustments */
        .custom-scale .rating-option {
          width: auto;
          min-width: 60px;
        }

        .custom-scale .rating-circle {
          width: 45px;
          height: 45px;
          font-size: 18px;
        }

        /* Three option scale adjustments */
        .three-option-scale {
          flex-direction: column;
          gap: 10px;
        }

        .three-option-scale .rating-option {
          width: 100%;
          max-width: 250px;
          margin: 0 auto;
        }

        /* Results container adjustments */
        .results-container {
          padding: 1rem;
        }

        .score-display {
          width: 150px;
          height: 150px;
        }

        #total-score {
          font-size: 2.5rem;
        }

        .category-text {
          font-size: 1rem;
        }

        /* Navigation buttons */
        .question-nav {
          flex-wrap: wrap;
          gap: 10px;
        }

        .calculate-btn {
          width: 100%;
          margin: 5px 0;
        }

        /* Progress bar */
        .progress-container {
          margin: 10px 0 20px;
        }
      }

      /* Additional fixes for very small screens */
      @media (max-width: 375px) {
        .rating-circle {
          width: 30px;
          height: 30px;
          font-size: 12px;
        }

        .rating-label {
          font-size: 9px;
        }
      }

      /* Start Screen Styling */
      .start-container {
        padding: 40px;
        margin-bottom: 30px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        text-align: center;
        animation: fadeIn 0.8s ease-out both;
      }

      .start-container h3 {
        font-family: "Playfair Display", serif;
        font-weight: 700;
        font-size: 2rem;
        color: #333;
        margin-bottom: 20px;
      }

      .start-container p {
        font-family: "Poppins", sans-serif;
        font-size: 1.1rem;
        color: #666;
        margin-bottom: 15px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      #start-btn {
        margin-top: 20px;
        padding: 12px 30px;
        font-size: 16px;
        animation: pulse 1.5s infinite;
      }

      /* Name input styling */
      .name-input-container {
        margin: 20px auto;
        max-width: 400px;
      }

      .name-input-container input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: "Poppins", sans-serif;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .name-input-container input:focus {
        border-color: #c59a6d;
        box-shadow: 0 0 0 2px rgba(197, 154, 109, 0.2);
        outline: none;
      }

      .name-error {
        color: #e74c3c;
        font-size: 14px;
        margin-top: 5px;
        display: none;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(197, 154, 109, 0.4);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(197, 154, 109, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(197, 154, 109, 0);
        }
      }

      /* Email sending notification */
      .email-notification {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #c59a6d;
        font-size: 14px;
        color: #666;
      }

      .email-notification i {
        margin-right: 8px;
        color: #c59a6d;
      }
    </style>
  </head>
  <body>
    <!-- Use the same nav placeholder as services.html -->
    <div id="nav-placeholder"></div>

    <!-- Questionnaire Section -->
    <section id="services" class="questionnaire-section">
      <div class="container text-center">
        <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <div class="section-title">
              <h2>Health Assessment</h2>
              <p>Please rate your symptoms on a scale of 1 to 5</p>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-8 col-md-offset-2">
            <div class="calculator-card">
              <!-- Start Screen -->
              <div id="start-screen" class="text-center">
                <div class="start-container">
                  <h3>Gut Health Assessment</h3>
                  <p>
                    This questionnaire will help evaluate your gut health based
                    on your symptoms. It takes about 5 minutes to complete.
                  </p>
                  <p>
                    Please answer each question honestly for the most accurate
                    results.
                  </p>
                  <div class="name-input-container">
                    <input
                      type="text"
                      id="user-name"
                      placeholder="Enter your name"
                      required
                    />
                    <div class="name-error" id="name-error">
                      Please enter your name to continue
                    </div>
                  </div>
                  <div class="name-input-container" style="margin-top: 15px">
                    <input
                      type="text"
                      id="user-contact"
                      placeholder="Enter your email or phone number"
                      required
                    />
                    <div class="name-error" id="contact-error">
                      Please enter your contact information to continue
                    </div>
                  </div>
                  <button id="start-btn" class="calculate-btn">
                    Start Assessment
                  </button>
                </div>
              </div>

              <!-- Progress Bar (initially hidden) -->
              <div class="progress-container" style="display: none">
                <div class="progress">
                  <div
                    id="progress-bar"
                    class="progress-bar"
                    role="progressbar"
                    style="width: 0%"
                    aria-valuenow="0"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>
              </div>

              <div id="question-container" style="display: none">
                <!-- Questions will be dynamically inserted here -->
              </div>

              <div class="text-center" style="margin-top: 20px">
                <button
                  id="next-btn"
                  class="calculate-btn"
                  style="display: none"
                >
                  Next
                </button>
                <button
                  id="submit-btn"
                  class="calculate-btn"
                  style="display: none"
                >
                  Submit
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Include same scripts as services.html -->
    <script src="js/jquery.1.11.1.js"></script>
    <script>
      $(function () {
        $("#nav-placeholder").load("nav.html");
        $("#footer-placeholder").load("footer.html");
      });
    </script>

    <script>
      const questions = [
        { id: 1, text: "Gassy?" },
        { id: 2, text: "Bloating?" },
        { id: 3, text: "Heaviness after meals?" },
        { id: 4, text: "Stomach pain?" },
        { id: 5, text: "Lethargy or feeling tired?" },
        { id: 6, text: "Brain fog?" },
        { id: 7, text: "Constipation (without laxative)?" },
        {
          id: 8,
          text: "How often do you poop?",
          isCustomScale: true,
          labels: [
            { emoji: "ðŸ’©", text: "Less than three times a week" },
            { emoji: "ðŸ’©ðŸ’«", text: "Once every other day" },
            { emoji: "ðŸ’©âœ¨", text: "Once a day" },
            { emoji: "ðŸ’©ðŸ’©", text: "Twice a day" },
            { emoji: "ðŸ’©ðŸ’©âž•", text: "More than two times a day" },
          ],
          values: [
            "Less than three times a week",
            "Once every other day",
            "Once a day",
            "Twice a day",
            "More than two times a day",
          ],
        },
        { id: 9, text: "Mucus in stools?" },
        {
          id: 10,
          text: "Floating stools?",
          isCustomScale: true,
          labels: [
            { text: "Rarely or not noticed" },
            { text: "Sometimes" },
            { text: "Very often" },
          ],
          values: ["Rarely or not noticed", "Sometimes", "Very often"],
        },
        { id: 11, text: "Smelly stools?" },
        { id: 12, text: "Bad breath?" },
        { id: 13, text: "Oral thrush/ white layer on your tongue?" },
        { id: 14, text: "Acne?" },
        { id: 15, text: "Eczema/ psoriasis/ rosacea/ rashes?" },
        { id: 16, text: "Excessive hairfall?" },
        { id: 17, text: "Dry and Brittle hair?" },
        { id: 18, text: "Acidity/heartburn/ reflux?" },
        { id: 19, text: "Nausea?" },
        { id: 20, text: "Burping/Belching?" },
        { id: 21, text: "Sweet cravings?" },
        { id: 22, text: "Disturbed sleep?" },
        { id: 23, text: "How would you rate your anxiety or stress?" },
        { id: 24, text: "Stubborn weight/ resistant metabolism?" },
      ];

      let currentQuestion = 0;
      const answers = {};
      let userName = "";
      let userContact = "";

      function displayQuestion(index) {
        const question = questions[index];
        const isLast = index === questions.length - 1;

        // Update progress bar
        const progressPercentage = ((index + 1) / questions.length) * 100;
        document.getElementById(
          "progress-bar"
        ).style.width = `${progressPercentage}%`;
        document
          .getElementById("progress-bar")
          .setAttribute("aria-valuenow", progressPercentage);

        let optionsHTML;
        if (question.id === 10) {
          // Floating stools question
          optionsHTML = `
            <div class="rating-scale three-option-scale">
              ${question.labels
                .map(
                  (label, idx) => `
                <div class="rating-option ${
                  answers[question.id] === idx + 1 ? "selected" : ""
                }" 
                     onclick="updateRating(${question.id}, ${idx + 1})">
                    <div class="rating-circle rating-${idx + 1}">
                        ${idx + 1}
                    </div>
                    <div class="rating-label">
                        ${label.text}
                    </div>
                </div>
              `
                )
                .join("")}
            </div>
          `;
        } else if (question.id === 8) {
          // Question 8 - How often do you poop (special handling)
          optionsHTML = `
            <div class="rating-scale custom-scale">
              ${question.labels
                .map(
                  (label, idx) => `
                <div class="rating-option" onclick="updateRating(${
                  question.id
                }, ${idx + 1})">
                    <div class="rating-circle rating-${idx + 1} ${
                    answers[question.id] === idx + 1 ? "selected" : ""
                  }">
                        ${label.emoji || ""}
                    </div>
                    <div class="rating-label">
                        ${label.text}
                    </div>
                </div>
              `
                )
                .join("")}
            </div>
          `;
        } else if (question.isCustomScale) {
          // Other custom scale questions
          optionsHTML = `
            <div class="rating-scale custom-scale">
              ${question.labels
                .map(
                  (label, idx) => `
                <div class="rating-option" onclick="updateRating(${
                  question.id
                }, ${idx + 1})">
                    <div class="rating-circle rating-${idx + 1} ${
                    answers[question.id] === idx + 1 ? "selected" : ""
                  }">
                        ${idx + 1}
                    </div>
                    <div class="rating-label">
                        ${label.text}
                    </div>
                </div>
              `
                )
                .join("")}
            </div>
          `;
        } else {
          // Original rating scale HTML for standard questions
          optionsHTML = `
            <div class="rating-scale">
              ${[1, 2, 3, 4, 5]
                .map(
                  (num) => `
                <div class="rating-option" onclick="updateRating(${
                  question.id
                }, ${num})">
                    <div class="rating-circle rating-${num} ${
                    answers[question.id] === num ? "selected" : ""
                  }">
                        ${num}
                    </div>
                    <div class="rating-label">
                        ${getRatingLabel(num)}
                    </div>
                </div>
              `
                )
                .join("")}
            </div>
          `;
        }

        const navigationHTML = `
          <div class="question-nav-wrapper">
              <div class="question-nav">
                  ${
                    index > 0
                      ? `<button class="calculate-btn previous-btn" onclick="previousQuestion()">
                          <i class="fas fa-chevron-left"></i> Prev
                      </button>`
                      : ""
                  }
                  ${
       !isLast
    ? `` /* no next button */
    : `<button class="calculate-btn ${!answers[question.id] ? "disabled" : ""}" 
        id="submit-button-${question.id}" 
        onclick="validateAndSubmit(${question.id})">
        Submit <i class="fas fa-check"></i>
    </button>`
              }

              </div>
          </div>
        `;

        const questionHTML = `
          <div class="question-counter">
              Question ${index + 1} of ${questions.length}
          </div>
          <div class="question-container" id="question-${question.id}">
              <h4>${question.text}<span class="question-required">*</span></h4>
              <input type="hidden" id="rating-${question.id}" value="${
          answers[question.id] || ""
        }">
              ${optionsHTML}
              <div class="answer-summary ${answers[question.id] ? "show" : ""}">
                  Your answer: <strong>${
                    question.isCustomScale && answers[question.id]
                      ? question.values[answers[question.id] - 1]
                      : answers[question.id]
                      ? getRatingLabel(answers[question.id])
                      : ""
                  }</strong>
              </div>
              <div class="error-message" id="error-${question.id}">
                  Please select an option before proceeding
              </div>
          </div>
          ${navigationHTML}
        `;

        document.getElementById("question-container").innerHTML = questionHTML;
      }

      function getRatingLabel(value) {
        switch (value) {
          case 1:
            return "Not at all";
          case 2:
            return "Mild";
          case 3:
            return "Moderate";
          case 4:
            return "Significant";
          case 5:
            return "Severe";
          default:
            return "";
        }
      }

      function updateRating(questionId, value) {
  answers[questionId] = parseInt(value);

  const question = questions.find((q) => q.id === questionId);

  // Update visual feedback
  document
    .querySelectorAll(`#question-${questionId} .rating-circle`)
    .forEach((circle) => {
      circle.classList.remove("selected");
    });

  const selectedCircle = document.querySelector(
    `#question-${questionId} .rating-${value}`
  );
  if (selectedCircle) {
    selectedCircle.classList.add("selected");
  }

  // Update answer summary
  const summaryDiv = document.querySelector(
    `#question-${questionId} .answer-summary`
  );
  const answerText = question.isCustomScale
    ? question.values[value - 1]
    : getRatingLabel(value);
  summaryDiv.innerHTML = `Your answer: <strong>${answerText}</strong>`;
  summaryDiv.classList.add("show");

  // Hide error message if shown
  const errorMessage = document.getElementById(`error-${questionId}`);
  if (errorMessage) {
    errorMessage.style.display = "none";
  }

  // Enable submit button on last question
  const submitButton = document.getElementById(
    `submit-button-${questionId}`
  );
  if (submitButton) submitButton.classList.remove("disabled");

  document.getElementById(`rating-${questionId}`).value = value;

  // Auto advance after short delay
  setTimeout(() => {
    if (currentQuestion < questions.length - 1) {
      nextQuestion();
    } else {
      displayResultsPrompt();
    }
  }, 200);
}


      function previousQuestion() {
        if (currentQuestion > 0) {
          currentQuestion--;
          displayQuestion(currentQuestion);
        }
      }

      function nextQuestion() {
        if (currentQuestion < questions.length - 1) {
          currentQuestion++;
          displayQuestion(currentQuestion);
        }
      }

      function sendReportToGoogleSheets(score) {
        // Prepare the report data
        const category =
          score > 70 ? "Category 4" : score > 40 ? "Category 2" : "Category 1";
        const highSymptoms = getHighScoredSymptoms();

        // Create a data object with all the information
        const data = {
          name: userName,
          contact: userContact,
          score: score,
          category: category,
          highSymptoms: highSymptoms.join(", "),
          timestamp: new Date().toISOString(),
        };

        // Add question answers
        questions.forEach((q) => {
          if (answers[q.id]) {
            let answerText = "";
            if (q.isCustomScale) {
              answerText = q.values[answers[q.id] - 1];
            } else {
              answerText = answers[q.id];
            }
            data[`Q${q.id}`] = answerText;
          }
        });

        // Create a hidden iframe to submit the form
        const iframe = document.createElement("iframe");
        iframe.style.display = "none";
        document.body.appendChild(iframe);

        // Create a form inside the iframe
        const form = document.createElement("form");
        form.method = "POST";
        form.action =
          "https://script.google.com/macros/s/AKfycbxnoC_XAIFqfPIOnjPacmXPx9HQ6HacPx8CtTU6OvcoQMI1idx9tqixLBJ3ZJ8EuAKg2g/exec";

        // Add all data as hidden form fields
        for (const [key, value] of Object.entries(data)) {
          const input = document.createElement("input");
          input.type = "hidden";
          input.name = key;
          input.value = value;
          form.appendChild(input);
        }

        // Add the form to the iframe and submit it
        iframe.contentDocument.body.appendChild(form);
        form.submit();

        // Remove the iframe after a delay
        setTimeout(() => {
          document.body.removeChild(iframe);
        }, 5000);

        // Show success message to user
        console.log("Assessment data recorded");
        const emailNotification = document.querySelector(".email-notification");
        if (emailNotification) {
          emailNotification.innerHTML = `
            <i class="fas fa-check-circle"></i> Your assessment has been recorded. Thank you, ${userName}!
            <div style="font-size:12px; margin-top:5px;">
              Score: ${score} (${category})
            </div>
          `;
        }

        // Log the data for debugging
        console.log("Data sent to Google Sheets:", data);
      }

      function displayResultsPrompt() {
  // Show submit button if on last question
  const submitBtn = document.getElementById(
    `submit-button-${questions[currentQuestion].id}`
  );
  if (submitBtn) {
    submitBtn.style.display = "inline-block";
  }
}

      function calculateScore() {
        let totalScore = 0;
        Object.values(answers).forEach((value) => {
          totalScore += value;
        });

        displayResults(totalScore);
        sendReportToGoogleSheets(totalScore);
      }

      function getHighScoredSymptoms() {
        const highSymptoms = [];
        questions.forEach((q, index) => {
          if (answers[q.id] >= 4) {
            // Get symptoms rated 4 or 5
            highSymptoms.push(q.text.replace("?", ""));
          }
        });
        return highSymptoms;
      }

      function displayResults(score) {
        let interpretation = "";
        let category = "";
        const highSymptoms = getHighScoredSymptoms();
        const symptomsText =
          highSymptoms.length > 0 ? `such as ${highSymptoms.join(", ")}` : "";

        if (score > 70) {
          category = "Category 4";
          interpretation = `Your gut health score places you in Category 4, indicating significant gut dysbiosis â€“ an imbalance with more harmful bacteria than beneficial ones. Given your symptoms, we believe a personalized approach will support a sustainable recovery. It's important to remember that this gut imbalance developed over time, so healing will also require patience and consistency.<br><br>Our 12-week Gut Health Program is crafted to suit your needs. It will help you identify the triggers behind your symptoms and restore a balanced gut microbiomeâ€”all from the comfort of your home, without medications or costly treatments.<br><br>We're excited to support you on your journey to better health!`;
        } else if (score > 40) {
          category = "Category 2";
          interpretation = `Your health currently falls into Category 2, indicating moderate gut dysbiosis. This means that certain food and lifestyle choices are affecting your gut health, which can contribute to hormonal imbalances, stubborn weight, or other symptoms ${symptomsText}.<br><br>The good news is, there's a proven protocol that can begin to improve your gut health in as little as six weeks. Contact us now.`;
        } else {
          category = "Category 1";
          interpretation = `Your gut health falls in category one, which means you have Little to moderate gut dysbiosis. Sing your habits and lifestyle choices It's a proven way to heal your gut before it becomes worse. Sign up now And see your symptoms And lead you on an uphill journey to a healthier lifestyle. We Look forward to supporting you every step of the way.`;
        }

        const resultsHTML = `
          <div class="results-container">
            <div class="score-display">
              <span class="category-text">${category}</span>
              <span id="total-score">${score}</span>
              <span class="category-text">out of 120</span>
            </div>
            <div class="score-interpretation">
              <h3>Your Gut Health Assessment</h3>
              <p>${interpretation}</p>
              <div class="email-notification">
                <i class="fas fa-check-circle"></i> Your assessment has been recorded. Thank you, ${userName}!
              </div>
              <button class="calculate-btn" onclick="window.location.href='services.html'" style="margin-top: 1rem;">
                Book a Consultation
              </button>
            </div>
          </div>
        `;

        document.getElementById("question-container").innerHTML = resultsHTML;
        document.getElementById("submit-btn").style.display = "none";
        document.getElementById("next-btn").style.display = "none";
      }

      function validateAndProceed(questionId) {
        if (!answers[questionId]) {
          // Show error message
          const errorMessage = document.getElementById(`error-${questionId}`);
          errorMessage.style.display = "block";
          return;
        }
        nextQuestion();
      }

      function validateAndSubmit(questionId) {
        if (!answers[questionId]) {
          // Show error message
          const errorMessage = document.getElementById(`error-${questionId}`);
          errorMessage.style.display = "block";
          return;
        }
        calculateScore();
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Hide questions initially, show start screen
        document.getElementById("question-container").style.display = "none";
        document.getElementById("start-screen").style.display = "block";
        document.querySelector(".progress-container").style.display = "none";

        // Start button event listener
        document
          .getElementById("start-btn")
          .addEventListener("click", function () {
            // Get and validate user name
            userName = document.getElementById("user-name").value.trim();
            // Get contact information
            userContact = document.getElementById("user-contact").value.trim();

            if (!userName) {
              document.getElementById("name-error").style.display = "block";
              return;
            }

            if (!userContact) {
              document.getElementById("contact-error").style.display = "block";
              return;
            }

            // Hide start screen
            document.getElementById("start-screen").style.display = "none";

            // Show progress bar and first question
            document.querySelector(".progress-container").style.display =
              "block";
            document.getElementById("question-container").style.display =
              "block";

            // Display first question
            displayQuestion(0);
          });
      });
    </script>

    <!-- Add Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <div id="results-section"></div>

    <!-- Footer placeholder -->
    <div id="footer-placeholder"></div>
  </body>
</html>

